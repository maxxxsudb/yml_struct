СКРИПТ 1: ЭКСПОРТ (на источнике)
sql
-- Копируй весь результат и сохрани в файл export_revolute.txt
WITH user_roles AS (
    SELECT DISTINCT ROLE_NAME FROM "PUBLIC"."EFFECTIVE_ROLES" WHERE USER_NAME = 'REVOLUTE'
),
user_privs AS (
    SELECT DISTINCT PRIVILEGE, OBJECT_TYPE, SCHEMA_NAME, OBJECT_NAME, IS_GRANTABLE 
    FROM "PUBLIC"."EFFECTIVE_PRIVILEGES" 
    WHERE USER_NAME = 'REVOLUTE' AND GRANTEE_TYPE = 'USER'
)
-- Создание пользователя
SELECT 'CREATE USER "REVOLUTE" PASSWORD "ChangeMe123" NO FORCE_FIRST_PASSWORD_CHANGE;' AS commands
UNION ALL
-- Роли  
SELECT 'GRANT "' || ROLE_NAME || '" TO "REVOLUTE";' FROM user_roles
UNION ALL
-- Системные привилегии
SELECT 'GRANT ' || PRIVILEGE || ' TO "REVOLUTE"' || CASE WHEN IS_GRANTABLE='TRUE' THEN ' WITH ADMIN OPTION' ELSE '' END || ';'
FROM user_privs WHERE OBJECT_TYPE = 'SYSTEM'
UNION ALL  
-- Схемные привилегии
SELECT 'GRANT ' || PRIVILEGE || ' ON SCHEMA "' || SCHEMA_NAME || '" TO "REVOLUTE"' || CASE WHEN IS_GRANTABLE='TRUE' THEN ' WITH GRANT OPTION' ELSE '' END || ';'
FROM user_privs WHERE OBJECT_TYPE = 'SCHEMA'
UNION ALL
-- Объектные привилегии  
SELECT 'GRANT ' || PRIVILEGE || ' ON "' || SCHEMA_NAME || '"."' || OBJECT_NAME || '" TO "REVOLUTE"' || CASE WHEN IS_GRANTABLE='TRUE' THEN ' WITH GRANT OPTION' ELSE '' END || ';'
FROM user_privs WHERE OBJECT_TYPE IN ('TABLE','VIEW','PROCEDURE','FUNCTION')
ORDER BY commands;
СКРИПТ 2: ПРОВЕРКА (на целевой системе)
sql
-- Копируй список ролей из экспорта сюда между кавычек
WITH exported_roles AS (
    SELECT REGEXP_SUBSTR(grant_cmd, '"([^"]+)"', 1, 1, '', 1) AS role_name
    FROM (
        -- ВСТАВЬ СЮДА ВСЕ СТРОКИ GRANT "..." TO "REVOLUTE"; ИЗ ЭКСПОРТА
        SELECT 'GRANT "MODELING" TO "REVOLUTE";' AS grant_cmd FROM DUMMY
        UNION ALL SELECT 'GRANT "MONITORING" TO "REVOLUTE";' FROM DUMMY  
        -- ДОБАВЬ ВСЕ ОСТАЛЬНЫЕ СТРОКИ GRANT
    )
    WHERE grant_cmd LIKE 'GRANT "%' 
)
SELECT 'MISSING ROLE: ' || er.role_name AS missing_items
FROM exported_roles er
LEFT JOIN ROLES r ON er.role_name = r.role_name  
WHERE r.role_name IS NULL
UNION ALL
SELECT 'USER EXISTS: REVOLUTE' FROM USERS WHERE USER_NAME = 'REVOLUTE';
СКРИПТ 3: ИМПОРТ (на целевой системе)
sql
-- ВСТАВЬ СЮДА ВЕСЬ РЕЗУЛЬТАТ ИЗ СКРИПТА 1 И ВЫПОЛНИ
-- Пример:
-- CREATE USER "REVOLUTE" PASSWORD "ChangeMe123" NO FORCE_FIRST_PASSWORD_CHANGE;
-- GRANT "MODELING" TO "REVOLUTE";  
-- GRANT "MONITORING" TO "REVOLUTE";
-- ...все остальные команды из экспорта
